{
  "hash": "1c21c21028fccd84d7f824b33287859f",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"In class Exercise 07\"\nauthor: \"Lau Jia Yi\"\ndate: October 14, 2024\ndate-modified: \"last-modified\"\nexecute:\n  eval: true\n  echo: true\n  warning: false\n  freeze: true\n---\n\n::: {.cell}\n\n```{.r .cell-code}\npacman::p_load(olsrr, corrplot, ggpubr, sf, spdep, GWmodel, tmap, tidyverse, gtsummary, dplyr, sfdep)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ncondo_resale <- read_csv(\"data/aspatial/Condo_resale_2015.csv\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nglimpse(condo_resale)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nRows: 1,436\nColumns: 23\n$ LATITUDE             <dbl> 1.287145, 1.328698, 1.313727, 1.308563, 1.321437,…\n$ LONGITUDE            <dbl> 103.7802, 103.8123, 103.7971, 103.8247, 103.9505,…\n$ POSTCODE             <dbl> 118635, 288420, 267833, 258380, 467169, 466472, 3…\n$ SELLING_PRICE        <dbl> 3000000, 3880000, 3325000, 4250000, 1400000, 1320…\n$ AREA_SQM             <dbl> 309, 290, 248, 127, 145, 139, 218, 141, 165, 168,…\n$ AGE                  <dbl> 30, 32, 33, 7, 28, 22, 24, 24, 27, 31, 17, 22, 6,…\n$ PROX_CBD             <dbl> 7.941259, 6.609797, 6.898000, 4.038861, 11.783402…\n$ PROX_CHILDCARE       <dbl> 0.16597932, 0.28027246, 0.42922669, 0.39473543, 0…\n$ PROX_ELDERLYCARE     <dbl> 2.5198118, 1.9333338, 0.5021395, 1.9910316, 1.121…\n$ PROX_URA_GROWTH_AREA <dbl> 6.618741, 7.505109, 6.463887, 4.906512, 6.410632,…\n$ PROX_HAWKER_MARKET   <dbl> 1.76542207, 0.54507614, 0.37789301, 1.68259969, 0…\n$ PROX_KINDERGARTEN    <dbl> 0.05835552, 0.61592412, 0.14120309, 0.38200076, 0…\n$ PROX_MRT             <dbl> 0.5607188, 0.6584461, 0.3053433, 0.6910183, 0.528…\n$ PROX_PARK            <dbl> 1.1710446, 0.1992269, 0.2779886, 0.9832843, 0.116…\n$ PROX_PRIMARY_SCH     <dbl> 1.6340256, 0.9747834, 1.4715016, 1.4546324, 0.709…\n$ PROX_TOP_PRIMARY_SCH <dbl> 3.3273195, 0.9747834, 1.4715016, 2.3006394, 0.709…\n$ PROX_SHOPPING_MALL   <dbl> 2.2102717, 2.9374279, 1.2256850, 0.3525671, 1.307…\n$ PROX_SUPERMARKET     <dbl> 0.9103958, 0.5900617, 0.4135583, 0.4162219, 0.581…\n$ PROX_BUS_STOP        <dbl> 0.10336166, 0.28673408, 0.28504777, 0.29872340, 0…\n$ NO_Of_UNITS          <dbl> 18, 20, 27, 30, 30, 31, 32, 32, 32, 32, 34, 34, 3…\n$ FAMILY_FRIENDLY      <dbl> 0, 0, 0, 0, 0, 1, 1, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0…\n$ FREEHOLD             <dbl> 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 1, 1, 1, 1, 1, 1…\n$ LEASEHOLD_99YR       <dbl> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ncondo_resale_sf <- st_as_sf(condo_resale,\n                            coords = c(\"LONGITUDE\", \"LATITUDE\"),\n                            crs=4326) %>%\n  st_transform(crs=3414)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ncondo_mlr <- lm(formula = SELLING_PRICE ~ AREA_SQM +\n                  AGE + PROX_CBD + PROX_CHILDCARE +\n                  PROX_ELDERLYCARE + PROX_URA_GROWTH_AREA +\n                  PROX_HAWKER_MARKET + PROX_KINDERGARTEN +\n                  PROX_MRT + PROX_PARK + PROX_PRIMARY_SCH +\n                  PROX_TOP_PRIMARY_SCH + PROX_SHOPPING_MALL +\n                  PROX_SUPERMARKET + PROX_BUS_STOP +\n                  NO_Of_UNITS + FAMILY_FRIENDLY +\n                  FREEHOLD,\n                data=condo_resale_sf)\n```\n:::\n\n\n\n### Model Assessment: olsrr method\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nols_regress(condo_mlr)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n                                Model Summary                                 \n-----------------------------------------------------------------------------\nR                            0.807       RMSE                     750799.558 \nR-Squared                    0.652       MSE                571258408962.149 \nAdj. R-Squared               0.647       Coef. Var                    43.160 \nPred R-Squared               0.637       AIC                       42970.175 \nMAE                     413425.809       SBC                       43075.567 \n-----------------------------------------------------------------------------\n RMSE: Root Mean Square Error \n MSE: Mean Square Error \n MAE: Mean Absolute Error \n AIC: Akaike Information Criteria \n SBC: Schwarz Bayesian Criteria \n\n                                     ANOVA                                       \n--------------------------------------------------------------------------------\n                    Sum of                                                      \n                   Squares          DF         Mean Square       F         Sig. \n--------------------------------------------------------------------------------\nRegression    1.515174e+15          18        8.417631e+13    147.352    0.0000 \nResidual      8.094732e+14        1417    571258408962.149                      \nTotal         2.324647e+15        1435                                          \n--------------------------------------------------------------------------------\n\n                                               Parameter Estimates                                                \n-----------------------------------------------------------------------------------------------------------------\n               model           Beta    Std. Error    Std. Beta       t        Sig           lower          upper \n-----------------------------------------------------------------------------------------------------------------\n         (Intercept)     481728.405    121441.014                   3.967    0.000     243504.909     719951.900 \n            AREA_SQM      12708.324       369.590        0.580     34.385    0.000      11983.322      13433.326 \n                 AGE     -24440.816      2763.164       -0.165     -8.845    0.000     -29861.148     -19020.484 \n            PROX_CBD     -78669.779      6768.972       -0.268    -11.622    0.000     -91948.061     -65391.496 \n      PROX_CHILDCARE    -351617.910    109467.252       -0.092     -3.212    0.001    -566353.201    -136882.619 \n    PROX_ELDERLYCARE     171029.418     42110.506        0.083      4.061    0.000      88423.783     253635.053 \nPROX_URA_GROWTH_AREA      38474.534     12523.567        0.059      3.072    0.002      13907.809      63041.258 \n  PROX_HAWKER_MARKET      23746.098     29299.755        0.019      0.810    0.418     -33729.461      81221.657 \n   PROX_KINDERGARTEN     147468.986     82668.868        0.031      1.784    0.075     -14697.534     309635.506 \n            PROX_MRT    -314599.679     57947.441       -0.120     -5.429    0.000    -428271.672    -200927.687 \n           PROX_PARK     563280.499     66551.675        0.148      8.464    0.000     432730.102     693830.897 \n    PROX_PRIMARY_SCH     180186.083     65237.948        0.070      2.762    0.006      52212.744     308159.421 \nPROX_TOP_PRIMARY_SCH       2280.036     20410.435        0.002      0.112    0.911     -37757.880      42317.951 \n  PROX_SHOPPING_MALL    -206604.057     42840.595       -0.108     -4.823    0.000    -290641.863    -122566.252 \n    PROX_SUPERMARKET     -44991.803     77082.635       -0.012     -0.584    0.560    -196200.149     106216.542 \n       PROX_BUS_STOP     683121.347    138353.278        0.134      4.938    0.000     411722.087     954520.608 \n         NO_Of_UNITS       -231.180        89.033       -0.050     -2.597    0.010       -405.830        -56.530 \n     FAMILY_FRIENDLY     140340.770     47020.551        0.055      2.985    0.003      48103.399     232578.141 \n            FREEHOLD     359913.008     49220.224        0.140      7.312    0.000     263360.671     456465.345 \n-----------------------------------------------------------------------------------------------------------------\n```\n\n\n:::\n:::\n\n\n\n### Multi-collinearity\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nols_vif_tol(condo_mlr)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n              Variables Tolerance      VIF\n1              AREA_SQM 0.8625928 1.159296\n2                   AGE 0.7026139 1.423257\n3              PROX_CBD 0.4605774 2.171188\n4        PROX_CHILDCARE 0.2981029 3.354546\n5      PROX_ELDERLYCARE 0.5922259 1.688545\n6  PROX_URA_GROWTH_AREA 0.6614127 1.511915\n7    PROX_HAWKER_MARKET 0.4373889 2.286295\n8     PROX_KINDERGARTEN 0.8370845 1.194622\n9              PROX_MRT 0.5049530 1.980382\n10            PROX_PARK 0.8018396 1.247132\n11     PROX_PRIMARY_SCH 0.3855782 2.593508\n12 PROX_TOP_PRIMARY_SCH 0.4968645 2.012621\n13   PROX_SHOPPING_MALL 0.4906426 2.038144\n14     PROX_SUPERMARKET 0.6152063 1.625471\n15        PROX_BUS_STOP 0.3320516 3.011580\n16          NO_Of_UNITS 0.6731165 1.485627\n17      FAMILY_FRIENDLY 0.7202230 1.388459\n18             FREEHOLD 0.6729095 1.486084\n```\n\n\n:::\n:::\n\n\n\n### Variable selection\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncondo_fw_mlr <- ols_step_forward_p(\n  condo_mlr,\n  p_val = 0.05,\n  details = FALSE)\n```\n:::\n\n\n\n### Test for Normality Assumption\n\nTest the model directly via \\$model call from condo fw mlr.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nols_plot_resid_fit(condo_fw_mlr$model) \n```\n\n::: {.cell-output-display}\n![](In-class_Ex07_files/figure-html/unnamed-chunk-9-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nmlr_output <- as.data.frame(condo_fw_mlr$model$residuals) %>%\n  rename(`FW_MLR_RES` = `condo_fw_mlr$model$residuals`)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ncondo_resale_sf <- cbind(condo_resale_sf,\n                         mlr_output$FW_MLR_RES) %>%\n  rename(`MLR_RES` = `mlr_output.FW_MLR_RES`)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ntmap_mode(\"view\")\ntm_shape(mpsz)+\n  tmap_options(check.and.fix = TRUE) +\n  tm_polygons(alpha = 0.4) +\ntm_shape(condo_resale_sf) +\n  tm_dots(col = \"MLR_RES\",\n          alpha = 0.6,\n          style = \"quantile\")\ntmap_mode(\"plot\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ncondo_resale_sf <- condo_resale_sf %>%\n  mutate(nb = st_knn(geometry, k=6,\n                    longlat = FALSE),\n         wt = st_weights(nb,\n                         style = \"W\"),\n         .before = 1)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(1234)\n\nglobal_moran_perm(condo_resale_sf$MLR_RES,\n                  condo_resale_sf$nb,\n                  condo_resale_sf$wt,\n                  alternative = \"two.sided\",\n                  nsim=99)\n```\n:::\n\n\n\nThe Global Moran's I test for residual spatial autocorrelation shows that it's p-value is less than 0.00000000000000000000022 which is less than the alpha value of 0.05. Hence we will reject the null hypothesis that the residuals are randomly distributed.\n\nSince the Observed Global moran I = 0.25586 which is greater than 0, we can infer that the residuals resemble cluster distribution.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbw_fixed <- bw.gwr(formula = SELLING_PRICE ~ AREA_SQM +\n                         AGE + PROX_CBD + PROX_CHILDCARE +\n                         PROX_ELDERLYCARE + PROX_URA_GROWTH_AREA +\n                         PROX_HAWKER_MARKET + PROX_KINDERGARTEN +\n                         PROX_MRT + PROX_PARK + PROX_PRIMARY_SCH +\n                         PROX_TOP_PRIMARY_SCH + PROX_SHOPPING_MALL +\n                         PROX_SUPERMARKET + PROX_BUS_STOP +\n                         NO_Of_UNITS + FAMILY_FRIENDLY +\n                         FREEHOLD,\n                       data=condo_resale.sf,\n                       bw=bw_fixed,\n                       kernel = 'gaussian',\n                       longlat = FALSE) \n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ngwr_fixed <- gwr.basic(formula = SELLING_PRICE ~ AREA_SQM +\n                         AGE + PROX_CBD + PROX_CHILDCARE +\n                         PROX_ELDERLYCARE + PROX_URA_GROWTH_AREA +\n                         PROX_HAWKER_MARKET + PROX_KINDERGARTEN +\n                         PROX_MRT + PROX_PARK + PROX_PRIMARY_SCH +\n                         PROX_TOP_PRIMARY_SCH + PROX_SHOPPING_MALL +\n                         PROX_SUPERMARKET + PROX_BUS_STOP +\n                         NO_Of_UNITS + FAMILY_FRIENDLY +\n                         FREEHOLD,\n                       data=condo_resale.sf,\n                       bw=bw_fixed,\n                       kernel = 'gaussian',\n                       longlat = FALSE)\n```\n:::\n\n\n\n### Take-home EX! Take note of this to tidy up dataset.x\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ngwr_adaptive_output <- as.data.frame(\n  gwr_adaptive$SDF) %>%\n  select(-c(2:15))\n```\n:::\n",
    "supporting": [
      "In-class_Ex07_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}